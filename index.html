<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ© - Ù…Ù†ØµØ© Ø§Ù„Ø®ØªÙ…Ø©</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap');
        body { font-family: 'Cairo', sans-serif; background: #fdfdfd; }
        .app-card { border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.03); background: white; border: 1px solid #f0f0f0; }
        .part-btn { aspect-ratio: 1; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-weight: 800; transition: all 0.2s; border: 2px solid #eee; }
        .part-btn.available { background: white; color: #444; }
        .part-btn.completed { background: #10b981; color: white; border-color: #059669; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3); }
    </style>
</head>
<body class="bg-gray-50 pb-10">

    <div class="max-w-md mx-auto mt-4 px-4">
        <div class="app-card overflow-hidden">
            <img src="https://i.ibb.co/WvZGGrbs/Screenshot-20260206-224422.png" class="w-full h-auto object-cover">
            <div class="p-4 text-center">
                <h1 class="text-xl font-extrabold text-gray-800 italic">ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ© Ø¹Ù† Ø£Ø±ÙˆØ§Ø­ Ø§Ù„Ù…Ø±Ø­ÙˆÙ…ÙŠÙ†</h1>
                <p class="text-emerald-600 font-semibold mt-1">Ù…Ø®ÙŠØ¨Ø± ÙˆØ±Ù‡Ù Ø§Ù„Ù‚ØµÙŠØ±</p>
            </div>
        </div>
    </div>

    <div class="max-w-md mx-auto mt-6 px-4">
        <div class="app-card p-5">
            <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                <span class="text-emerald-500 text-2xl">ğŸ“–</span> Ø®ØªÙ…Ø© Ø§Ù„Ø¬Ù…Ø§Ø¹Ø©
            </h2>
            <div id="grid" class="grid grid-cols-5 gap-3">
                </div>
        </div>
    </div>

    <div class="max-w-md mx-auto mt-6 px-4">
        <div class="app-card p-5">
            <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                <span class="text-emerald-500 text-2xl">ğŸ¤</span> Ø­Ø§Ø¦Ø· Ø§Ù„Ø¯Ø¹Ø§Ø¡
            </h2>
            <textarea id="msg" placeholder="Ø§ÙƒØªØ¨ Ø¯Ø¹Ø§Ø¡Ù‹ ØµØ§Ø¯Ù‚Ø§Ù‹..." class="w-full bg-gray-50 border-0 rounded-xl p-4 text-sm focus:ring-2 focus:ring-emerald-500 outline-none" rows="3"></textarea>
            <button onclick="addMsg()" class="w-full mt-3 bg-emerald-600 text-white font-bold py-3 rounded-xl shadow-lg shadow-emerald-200">Ø¥Ø±Ø³Ø§Ù„</button>
            
            <div id="wall" class="mt-6 space-y-4">
                </div>
        </div>
    </div>

    <script>
        const S_URL = 'https://dsfhfusjtteyjtlmeavj.supabase.co';
        const S_KEY = 'sb_publishable_e10o67AI9hzJKY8COhs97g_5PWdvbKk';
        const client = supabase.createClient(S_URL, S_KEY);

        async function load() {
            const { data: parts } = await client.from('khatmas').select('*').order('id');
            const grid = document.getElementById('grid');
            grid.innerHTML = (parts || []).map(p => `
                <button onclick="mark(${p.id}, '${p.status}')" class="part-btn ${p.status === 'completed' ? 'completed' : 'available'}">
                    ${p.part_number}
                </button>
            `).join('');

            const { data: msgs } = await client.from('prayers').select('*').order('created_at', { ascending: false });
            document.getElementById('wall').innerHTML = (msgs || []).map(m => `
                <div class="bg-emerald-50/50 p-4 rounded-2xl border-r-4 border-emerald-500 text-right">
                    <p class="text-gray-700 text-sm leading-relaxed">${m.prayer_content}</p>
                    <span class="text-[10px] text-gray-400 mt-2 block">${new Date(m.created_at).toLocaleDateString('ar-EG')}</span>
                </div>
            `).join('');
        }

        async function mark(id, status) {
            if(status === 'completed') return;
            if(confirm('Ù‡Ù„ Ø£ØªÙ…Ù…Øª Ù‚Ø±Ø§Ø¡Ø© Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ØŸ')) {
                await client.from('khatmas').update({ status: 'completed' }).eq('id', id);
                load();
            }
        }

        async function addMsg() {
            const txt = document.getElementById('msg').value;
            if(!txt) return;
            await client.from('prayers').insert([{ prayer_content: txt }]);
            document.getElementById('msg').value = '';
            load();
        }

        load();
    </script>
</body>
</html>
